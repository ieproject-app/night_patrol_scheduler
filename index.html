<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penjadwal Ronda Malam - Simple</title>
    <style>
        /* Base styles */
        :root {
            --primary: #2563eb;
            --secondary: #64748b;
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --surface: #ffffff;
            --background: #f1f5f9;
            --text: #0f172a;
            --border: #e2e8f0;
            --radius: 8px;
            --shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--background);
            color: var(--text);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--surface);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        /* Form styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
        }

        input, select, textarea {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
        }

        .btn-secondary {
            background: var(--secondary);
        }

        /* Schedule display */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .schedule-card {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 15px;
        }

        .today {
            background: #fef3c7;
            border-color: var(--warning);
        }

        /* Import/Export */
        .import-export {
            margin-top: 20px;
            padding: 15px;
            background: var(--background);
            border-radius: var(--radius);
        }

        #importData {
            width: 100%;
            min-height: 100px;
            margin: 10px 0;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Penjadwal Ronda Malam</h1>
        
        <div class="form-grid">
            <div class="form-group">
                <label>üìÖ Tanggal Mulai</label>
                <input type="date" id="startDate" required>
            </div>
            <div class="form-group">
                <label>üìÖ Tanggal Selesai</label>
                <input type="date" id="endDate" required>
            </div>
            <div class="form-group">
                <label>üë• Jumlah Tim</label>
                <input type="number" id="teamCount" value="16" min="1" required>
            </div>
            <div class="form-group">
                <label>‚è∞ Interval (hari)</label>
                <input type="number" id="interval" value="1" min="1" required>
            </div>
        </div>

        <div class="form-group">
            <label>üìù Nama Tim (satu per baris)</label>
            <textarea id="teamNames" rows="5" placeholder="Tim 1&#10;Tim 2&#10;Tim 3"></textarea>
        </div>

        <div class="button-group">
            <button class="btn" onclick="generateSchedule()">Buat Jadwal</button>
            <button class="btn btn-secondary" onclick="showImportExport()">Import/Export Data</button>
        </div>

        <div id="importExportSection" class="import-export" style="display: none;">
            <h3>Import/Export Data</h3>
            <textarea id="importData" placeholder="Paste data jadwal di sini untuk import..."></textarea>
            <div class="button-group">
                <button class="btn" onclick="importSchedule()">Import</button>
                <button class="btn" onclick="exportSchedule()">Export</button>
            </div>
        </div>

        <div id="scheduleOutput" class="schedule-grid"></div>
    </div>

    <script>
        // Global state
        let currentSchedule = null;

        // Initialize dates
        window.onload = () => {
            const today = new Date();
            const thirtyDaysLater = new Date();
            thirtyDaysLater.setDate(today.getDate() + 30);

            document.getElementById('startDate').value = formatDate(today);
            document.getElementById('endDate').value = formatDate(thirtyDaysLater);
        };

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDisplayDate(date) {
            return new Date(date).toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function generateSchedule() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);
            const teamCount = parseInt(document.getElementById('teamCount').value);
            const interval = parseInt(document.getElementById('interval').value);
            let teamNames = document.getElementById('teamNames').value
                .trim()
                .split('\n')
                .filter(name => name.trim());

            // Generate default team names if none provided
            if (teamNames.length === 0) {
                teamNames = Array.from({length: teamCount}, (_, i) => `Tim ${i + 1}`);
            }

            // Generate schedule
            const schedule = [];
            let currentDate = new Date(startDate);
            let teamIndex = 0;

            while (currentDate <= endDate) {
                const currentTeam = teamNames[teamIndex % teamNames.length];
                
                schedule.push({
                    date: new Date(currentDate),
                    team: currentTeam
                });

                currentDate.setDate(currentDate.getDate() + interval);
                teamIndex++;
            }

            currentSchedule = schedule;
            displaySchedule(schedule);
            return schedule;
        }

        function displaySchedule(schedule) {
            const output = document.getElementById('scheduleOutput');
            output.innerHTML = '';

            if (!schedule || schedule.length === 0) {
                output.innerHTML = '<p>Tidak ada jadwal untuk ditampilkan.</p>';
                return;
            }

            // Group by month
            const scheduleByMonth = {};
            schedule.forEach(item => {
                const monthYear = item.date.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
                if (!scheduleByMonth[monthYear]) {
                    scheduleByMonth[monthYear] = [];
                }
                scheduleByMonth[monthYear].push(item);
            });

            // Display each month
            for (const [month, items] of Object.entries(scheduleByMonth)) {
                const monthContainer = document.createElement('div');
                monthContainer.className = 'schedule-card';
                monthContainer.innerHTML = `<h3>${month}</h3>`;

                items.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = isToday(item.date) ? 'today' : '';
                    itemDiv.innerHTML = `
                        <p><strong>${formatDisplayDate(item.date)}</strong></p>
                        <p>üë• ${item.team}</p>
                    `;
                    monthContainer.appendChild(itemDiv);
                });

                output.appendChild(monthContainer);
            }
        }

        function isToday(date) {
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }

        function showImportExport() {
            const section = document.getElementById('importExportSection');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
        }

        function exportSchedule() {
            if (!currentSchedule) {
                alert('Buat jadwal terlebih dahulu sebelum mengekspor!');
                return;
            }

            const exportData = {
                version: '1.0',
                timestamp: new Date().toISOString(),
                schedule: currentSchedule.map(item => ({
                    date: item.date.toISOString(),
                    team: item.team
                }))
            };

            document.getElementById('importData').value = JSON.stringify(exportData, null, 2);
        }

        function importSchedule() {
            try {
                const data = JSON.parse(document.getElementById('importData').value);
                
                if (!data.schedule || !Array.isArray(data.schedule)) {
                    throw new Error('Invalid data format');
                }

                const schedule = data.schedule.map(item => ({
                    date: new Date(item.date),
                    team: item.team
                }));

                currentSchedule = schedule;
                displaySchedule(schedule);

                // Update form fields based on imported data
                if (schedule.length > 0) {
                    document.getElementById('startDate').value = formatDate(schedule[0].date);
                    document.getElementById('endDate').value = formatDate(schedule[schedule.length - 1].date);
                    
                    // Extract unique team names
                    const teamNames = [...new Set(schedule.map(item => item.team))];
                    document.getElementById('teamNames').value = teamNames.join('\n');
                    document.getElementById('teamCount').value = teamNames.length;
                }

                alert('Jadwal berhasil diimpor!');
            } catch (error) {
                alert('Gagal mengimpor data. Pastikan format data sudah benar.');
                console.error('Import error:', error);
            }
        }
    </script>
</body>
</html>
