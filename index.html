<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penjadwal Ronda Malam</title>
    
    <style>
        /* --- Pengaturan Dasar & Font --- */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-color: #212529;
            --border-color: #dee2e6;
            --highlight-color: #fff3cd;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--surface-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        h1, h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        h2 {
            margin-top: 40px;
            color: var(--secondary-color);
            font-size: 1.5em;
        }

        /* --- Form Input --- */
        .form-container {
            margin-bottom: 30px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        input[type="date"],
        input[type="number"],
        textarea {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            grid-column: 1 / -1; /* Tombol memenuhi lebar grid */
            padding: 12px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
            background-color: var(--primary-color);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: #0056b3;
        }
        
        /* --- Tampilan Output --- */
        #output {
            margin-top: 30px;
        }

        .hidden {
            display: none;
        }

        /* Ringkasan Jadwal */
        #ringkasanJadwal {
            background-color: #e2f0ff;
            border-left: 5px solid var(--primary-color);
            padding: 15px 20px;
            margin-bottom: 30px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 4px;
        }

        /* Kontainer untuk setiap bulan yang berisi kolom-kolom jadwal */
        .bulan-container {
            display: flex;
            flex-wrap: wrap; /* Kunci responsivitas: bungkus ke baris baru jika tidak muat */
            gap: 20px;
        }
        
        /* Kolom visual yang menampung maksimal 10 baris jadwal */
        .jadwal-kolom {
            flex: 1; /* Kolom akan membagi ruang secara merata */
            min-width: 300px; /* Lebar minimum sebelum pindah ke baris baru */
        }
        
        .jadwal-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95em;
        }

        .jadwal-table th, .jadwal-table td {
            border: 1px solid var(--border-color);
            padding: 10px;
            text-align: left;
        }

        .jadwal-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        /* Sorotan untuk baris hari ini */
        .hari-ini {
            background-color: var(--highlight-color) !important;
            font-weight: bold;
            border-left: 4px solid #ffc107;
        }

        /* --- Area Ekspor & Instruksi --- */
        .export-container {
            margin-top: 40px;
        }

        #exportText {
            width: 100%;
            min-height: 150px;
            font-family: "Courier New", Courier, monospace;
            font-size: 0.9em;
            background-color: #e9ecef;
        }

        .export-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .salin-btn {
            padding: 10px 15px;
            font-size: 1rem;
            color: #fff;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .salin-btn:hover {
            background-color: #5a6268;
        }

        .instructions {
            margin-top: 15px;
            padding: 15px;
            background-color: #f4f4f4;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        .instructions ol {
            padding-left: 20px;
            margin: 0;
        }

        /* --- Style untuk Cetak (Print-Friendly) --- */
        @media print {
            body {
                padding: 0;
                font-size: 10pt; /* Ukuran font lebih kecil untuk cetak */
                background-color: #fff; /* Latar putih */
                color: #000;
            }
            .container {
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0;
                max-width: 100%;
            }
            
            /* Sembunyikan elemen yang tidak perlu dicetak */
            .form-container, .export-container, .btn, #ringkasanJadwal, h1 {
                display: none !important;
            }
            
            #output, .bulan-container, .jadwal-kolom {
                display: block !important; /* Pastikan semua wrapper terlihat */
            }
            
            .bulan-container {
                page-break-before: auto;
                page-break-inside: avoid;
            }
            
            .jadwal-table {
                width: 100%;
                border: 1px solid #000;
            }

            .jadwal-table th, .jadwal-table td {
                border: 1px solid #000; /* Border hitam jelas */
            }
            
            h2 {
                font-size: 14pt;
                color: #000;
                border: none;
                page-break-after: avoid;
                page-break-before: always; /* Setiap bulan mulai di halaman baru */
            }
            h2:first-of-type {
                 page-break-before: auto;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Generator Jadwal Ronda Malam</h1>
        
        <div class="form-container">
            <form id="jadwalForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="tanggalMulai">Tanggal Mulai</label>
                        <input type="date" id="tanggalMulai" required>
                    </div>
                    <div class="form-group">
                        <label for="tanggalBerakhir">Tanggal Berakhir</label>
                        <input type="date" id="tanggalBerakhir" required>
                    </div>
                    <div class="form-group">
                        <label for="jumlahTim">Jumlah Tim</label>
                        <input type="number" id="jumlahTim" value="16" min="1" required>
                    </div>
                     <div class="form-group">
                        <label for="interval">Interval Pergantian (hari)</label>
                        <input type="number" id="interval" value="1" min="1" required>
                    </div>
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="namaTim">Nama Tim (satu per baris, kosongkan untuk otomatis)</label>
                        <textarea id="namaTim" placeholder="Contoh:&#10;Tim Alpha&#10;Tim Bravo&#10;Tim Charlie"></textarea>
                    </div>
                </div>
                <button type="submit" class="btn">Buat Jadwal</button>
            </form>
        </div>

        <div id="output" class="hidden">
            <div id="ringkasanJadwal"></div>
            <div id="jadwalContainer">
                </div>

            <div class="export-container">
                <h2>Ekspor ke Excel</h2>
                <textarea id="exportText" readonly></textarea>
                <div class="export-controls">
                    <button id="salinBtn" class="salin-btn">Salin Teks</button>
                </div>
                <div class="instructions">
                    <strong>Cara menggunakan di Excel (Text to Columns):</strong>
                    <ol>
                        <li>Salin seluruh isi dari kotak teks di atas.</li>
                        <li>Tempel (Paste) di sel A1 pada lembar kerja Excel.</li>
                        <li>Pilih seluruh kolom A, lalu pergi ke menu <strong>Data</strong> &rarr; <strong>Text to Columns</strong>.</li>
                        <li>Pilih <strong>Delimited</strong>, lalu klik <strong>Next</strong>.</li>
                        <li>Beri centang pada <strong>Comma</strong> (koma) dan hilangkan centang lainnya. Klik <strong>Finish</strong>.</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Referensi Elemen DOM ---
        const form = document.getElementById('jadwalForm');
        const tanggalMulaiEl = document.getElementById('tanggalMulai');
        const tanggalBerakhirEl = document.getElementById('tanggalBerakhir');
        const jumlahTimEl = document.getElementById('jumlahTim');
        const intervalEl = document.getElementById('interval');
        const namaTimEl = document.getElementById('namaTim');
        const outputEl = document.getElementById('output');
        const ringkasanJadwalEl = document.getElementById('ringkasanJadwal');
        const jadwalContainerEl = document.getElementById('jadwalContainer');
        const exportTextEl = document.getElementById('exportText');
        const salinBtn = document.getElementById('salinBtn');

        // --- Inisialisasi & Pengaturan Default ---
        
        // Fungsi untuk memformat tanggal ke YYYY-MM-DD untuk input date picker
        const formatDateForInput = (date) => {
            const d = new Date(date);
            let month = '' + (d.getMonth() + 1);
            let day = '' + d.getDate();
            const year = d.getFullYear();

            if (month.length < 2) month = '0' + month;
            if (day.length < 2) day = '0' + day;

            return [year, month, day].join('-');
        };

        // Atur tanggal default
        const hariIni = new Date();
        const tigaPuluhHariLagi = new Date();
        tigaPuluhHariLagi.setDate(hariIni.getDate() + 30);

        tanggalMulaiEl.value = formatDateForInput(hariIni);
        tanggalBerakhirEl.value = formatDateForInput(tigaPuluhHariLagi);
        
        // --- Helper Functions ---

        /**
         * Memformat objek Date ke string yang mudah dibaca.
         * @param {Date} date - Objek tanggal.
         * @param {string} format - 'DD/MM/YYYY' atau 'full' (e.g., "Senin, 23 Juni 2025").
         * @returns {string} Tanggal yang diformat.
         */
        const formatTanggal = (date, format) => {
            if (format === 'DD/MM/YYYY') {
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            }
            if (format === 'full') {
                 return new Intl.DateTimeFormat('id-ID', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }).format(date);
            }
             if (format === 'month-year') {
                 return new Intl.DateTimeFormat('id-ID', { 
                    year: 'numeric', 
                    month: 'long'
                }).format(date);
            }
            return date.toString();
        };

        /**
         * Memeriksa apakah tanggal yang diberikan adalah hari ini.
         * @param {Date} date - Objek tanggal.
         * @returns {boolean} True jika tanggal adalah hari ini.
         */
        const isToday = (date) => {
            const today = new Date();
            return date.getDate() === today.getDate() &&
                   date.getMonth() === today.getMonth() &&
                   date.getFullYear() === today.getFullYear();
        };

        // --- Event Listeners ---
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // Mencegah form submit dan refresh halaman
            buatJadwal();
        });

        salinBtn.addEventListener('click', function() {
            exportTextEl.select();
            document.execCommand('copy'); // Metode fallback
            navigator.clipboard.writeText(exportTextEl.value).then(() => {
                const originalText = salinBtn.textContent;
                salinBtn.textContent = 'Tersalin!';
                setTimeout(() => {
                    salinBtn.textContent = originalText;
                }, 1500);
            }).catch(err => {
                console.error('Gagal menyalin teks: ', err);
            });
        });

        // --- Fungsi Logika Utama ---
        function buatJadwal() {
            // 1. Ambil nilai dari form
            const tanggalMulai = new Date(tanggalMulaiEl.value + 'T00:00:00');
            const tanggalBerakhir = new Date(tanggalBerakhirEl.value + 'T00:00:00');
            const jumlahTim = parseInt(jumlahTimEl.value, 10);
            const interval = parseInt(intervalEl.value, 10);
            
            let daftarNamaTim = namaTimEl.value.trim().split('\n').filter(nama => nama.trim() !== '');
            
            // 2. Jika nama tim kosong, buat nama default
            if (daftarNamaTim.length === 0) {
                daftarNamaTim = [];
                for (let i = 1; i <= jumlahTim; i++) {
                    daftarNamaTim.push(`Tim ${i}`);
                }
            }
            
            // 3. Buat daftar jadwal
            const jadwalLengkap = [];
            let tanggalSekarang = new Date(tanggalMulai);
            let indexTim = 0;
            
            while (tanggalSekarang <= tanggalBerakhir) {
                const timBertugas = daftarNamaTim[indexTim];
                
                for(let i = 0; i < interval && tanggalSekarang <= tanggalBerakhir; i++) {
                    jadwalLengkap.push({
                        tanggal: new Date(tanggalSekarang),
                        tim: timBertugas
                    });
                    tanggalSekarang.setDate(tanggalSekarang.getDate() + 1);
                }
                
                indexTim = (indexTim + 1) % daftarNamaTim.length; // Ulangi dari tim pertama
            }

            // 4. Render output ke halaman
            renderJadwal(jadwalLengkap);
        }

        // --- Fungsi Render ---
        function renderJadwal(jadwal) {
            // Kosongkan output sebelumnya
            jadwalContainerEl.innerHTML = '';
            exportTextEl.value = '';

            if (jadwal.length === 0) {
                jadwalContainerEl.innerHTML = '<p>Tidak ada jadwal untuk ditampilkan. Silakan periksa kembali input Anda.</p>';
                outputEl.classList.add('hidden');
                return;
            }

            // A. Kelompokkan jadwal per bulan
            const jadwalPerBulan = jadwal.reduce((acc, item) => {
                const bulanTahun = formatTanggal(item.tanggal, 'month-year');
                if (!acc[bulanTahun]) {
                    acc[bulanTahun] = [];
                }
                acc[bulanTahun].push(item);
                return acc;
            }, {});

            // B. Render setiap bulan
            for (const bulan in jadwalPerBulan) {
                const dataBulanIni = jadwalPerBulan[bulan];
                
                // Buat header bulan
                const headerBulan = document.createElement('h2');
                headerBulan.textContent = bulan;
                jadwalContainerEl.appendChild(headerBulan);

                // Buat kontainer untuk kolom-kolom bulan ini
                const bulanContainer = document.createElement('div');
                bulanContainer.className = 'bulan-container';
                
                // C. Bagi data bulan ini menjadi beberapa kolom (maksimal 10 baris per kolom)
                const ukuranKolom = 10;
                for (let i = 0; i < dataBulanIni.length; i += ukuranKolom) {
                    const potonganJadwal = dataBulanIni.slice(i, i + ukuranKolom);
                    
                    const kolomDiv = document.createElement('div');
                    kolomDiv.className = 'jadwal-kolom';
                    
                    const table = document.createElement('table');
                    table.className = 'jadwal-table';
                    
                    table.innerHTML = `
                        <thead>
                            <tr>
                                <th>Tanggal, Hari</th>
                                <th>Tim Bertugas</th>
                            </tr>
                        </thead>
                    `;
                    
                    const tbody = document.createElement('tbody');
                    potonganJadwal.forEach(item => {
                        const tr = document.createElement('tr');
                        
                        // Sorot baris 'hari ini'
                        if (isToday(item.tanggal)) {
                            tr.classList.add('hari-ini');
                        }
                        
                        const tdTanggal = document.createElement('td');
                        tdTanggal.textContent = formatTanggal(item.tanggal, 'full');
                        
                        const tdTim = document.createElement('td');
                        tdTim.textContent = item.tim;
                        
                        tr.appendChild(tdTanggal);
                        tr.appendChild(tdTim);
                        tbody.appendChild(tr);
                    });
                    
                    table.appendChild(tbody);
                    kolomDiv.appendChild(table);
                    bulanContainer.appendChild(kolomDiv);
                }

                jadwalContainerEl.appendChild(bulanContainer);
            }

            // D. Tampilkan ringkasan jadwal selanjutnya
            const hariIniTanpaWaktu = new Date();
            hariIniTanpaWaktu.setHours(0, 0, 0, 0);
            
            const jadwalSelanjutnya = jadwal.find(item => item.tanggal >= hariIniTanpaWaktu);
            if (jadwalSelanjutnya) {
                ringkasanJadwalEl.textContent = `Jadwal Selanjutnya: ${jadwalSelanjutnya.tim} pada ${formatTanggal(jadwalSelanjutnya.tanggal, 'full')}`;
            } else {
                ringkasanJadwalEl.textContent = 'Tidak ada jadwal mendatang.';
            }

            // E. Isi textarea ekspor
            const exportData = jadwal.map(item => `${formatTanggal(item.tanggal, 'DD/MM/YYYY')},${item.tim}`).join('\n');
            exportTextEl.value = exportData;

            // Tampilkan seluruh bagian output
            outputEl.classList.remove('hidden');
        }
    });
    </script>
</body>
</html>
