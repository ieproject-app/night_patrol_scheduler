<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penjadwal Ronda Malam</title>
    <style>
        /* Reset dan Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Form Section */
        .form-section {
            padding: 40px;
            background: #f8f9fa;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .form-group input,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        /* Button */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* Results Section */
        .results-section {
            padding: 40px;
        }

        .summary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .summary h3 {
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .summary p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        /* Responsive Table Grid */
        .table-container {
            margin-bottom: 30px;
        }

        .table-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Responsive breakpoints untuk tabel */
        @media (min-width: 1200px) {
            .table-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 768px) and (max-width: 1199px) {
            .table-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 767px) {
            .table-grid {
                grid-template-columns: 1fr;
            }
        }

        .table-section {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .table-header {
            background: linear-gradient(135deg, #495057 0%, #6c757d 100%);
            color: white;
            padding: 15px;
            font-weight: 600;
            text-align: center;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
        }

        .schedule-table th,
        .schedule-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .schedule-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .schedule-table tr:hover {
            background: #f8f9fa;
        }

        /* Highlight untuk hari ini */
        .today-row {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%) !important;
            border-left: 4px solid #ffc107;
        }

        .today-row:hover {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%) !important;
        }

        /* Export Section */
        .export-section {
            background: #f8f9fa;
            padding: 30px;
            border-top: 2px solid #e9ecef;
        }

        .export-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .export-textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 15px;
            resize: vertical;
        }

        .export-instructions {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
            margin-top: 20px;
        }

        .export-instructions h4 {
            color: #1976d2;
            margin-bottom: 15px;
        }

        .export-instructions ol {
            margin-left: 20px;
        }

        .export-instructions li {
            margin-bottom: 8px;
            color: #424242;
        }

        /* Utility Classes */
        .hidden {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
            }

            .form-section,
            .export-section,
            .btn-primary,
            .btn-secondary {
                display: none !important;
            }

            .container {
                box-shadow: none;
                border-radius: 0;
                max-width: none;
                margin: 0;
            }

            .header {
                background: #2c3e50 !important;
                -webkit-print-color-adjust: exact;
                padding: 20px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .results-section {
                padding: 20px;
            }

            /* Pertahankan grid layout untuk print dengan optimasi ukuran */
            .table-grid {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                page-break-inside: avoid;
            }

            /* Untuk kertas landscape atau A4 yang lebar, gunakan 3 kolom */
            @media print and (min-width: 800px) {
                .table-grid {
                    grid-template-columns: repeat(3, 1fr);
                }
            }

            .table-section {
                page-break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }

            .table-header {
                background: #f0f0f0 !important;
                -webkit-print-color-adjust: exact;
                font-size: 12px;
                padding: 8px;
                border-bottom: 2px solid #000;
            }

            .schedule-table {
                font-size: 10px;
                width: 100%;
            }

            .schedule-table th,
            .schedule-table td {
                padding: 4px 6px;
                border: 1px solid #666;
                font-size: 10px;
            }

            .schedule-table th {
                background: #f8f8f8 !important;
                -webkit-print-color-adjust: exact;
                font-weight: bold;
            }

            .today-row {
                background: #f0f0f0 !important;
                -webkit-print-color-adjust: exact;
                border-left: 3px solid #000 !important;
            }

            .summary {
                background: #e8e8e8 !important;
                -webkit-print-color-adjust: exact;
                border: 2px solid #000;
                color: #000 !important;
                padding: 15px;
                margin-bottom: 20px;
            }

            .summary h3 {
                color: #000 !important;
                font-size: 16px;
            }

            .summary p {
                color: #000 !important;
                font-size: 14px;
            }

            /* Pastikan tidak ada page break di tengah tabel */
            .table-section {
                break-inside: avoid;
            }

            /* Optimasi untuk orientasi kertas */
            @page {
                margin: 0.5in;
                size: A4;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-section,
            .results-section {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .export-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>Penjadwal Ronda Malam</h1>
            <p>Sistem Penjadwalan Otomatis untuk Keamanan Lingkungan</p>
        </div>

        <!-- Form Input Section -->
        <div class="form-section">
            <form id="scheduleForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="startDate">Tanggal Mulai:</label>
                        <input type="date" id="startDate" required>
                    </div>

                    <div class="form-group">
                        <label for="teamCount">Jumlah Tim:</label>
                        <input type="number" id="teamCount" min="1" value="16" required>
                    </div>

                    <div class="form-group">
                        <label for="interval">Interval Pergantian (hari):</label>
                        <input type="number" id="interval" min="1" value="1" required>
                    </div>

                    <div class="form-group full-width">
                        <label for="teamNames">Nama Tim (satu nama per baris, kosongkan untuk otomatis):</label>
                        <textarea id="teamNames" placeholder="Tim Alpha&#10;Tim Beta&#10;Tim Gamma&#10;...atau kosongkan untuk Tim 1, Tim 2, dst."></textarea>
                    </div>
                </div>

                <div class="text-center">
                    <button type="submit" class="btn-primary">Buat Jadwal</button>
                </div>
            </form>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section hidden">
            <!-- Summary akan diisi oleh JavaScript -->
            <div id="summaryContainer"></div>

            <!-- Table Container -->
            <div class="table-container">
                <div id="tableGrid" class="table-grid">
                    <!-- Tabel akan diisi oleh JavaScript -->
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div id="exportSection" class="export-section hidden">
            <h3>Export untuk Excel</h3>
            <textarea id="exportData" class="export-textarea" readonly placeholder="Data export akan muncul di sini..."></textarea>
            <button onclick="copyExportData()" class="btn-secondary">Salin Teks</button>

            <div class="export-instructions">
                <h4>Cara Import ke Excel:</h4>
                <ol>
                    <li><strong>Salin</strong> seluruh isi textarea di atas (gunakan tombol "Salin Teks" atau Ctrl+A lalu Ctrl+C)</li>
                    <li><strong>Buka Excel</strong> dan pilih sel A1 di sheet kosong</li>
                    <li><strong>Tempel</strong> data dengan Ctrl+V</li>
                    <li><strong>Pilih kolom A</strong> (klik header kolom A)</li>
                    <li>Pergi ke menu <strong>Data</strong> → <strong>Text to Columns</strong></li>
                    <li>Pilih <strong>Delimited</strong> → klik Next</li>
                    <li>Centang <strong>Comma ( , )</strong> → klik Finish</li>
                    <li>Data akan terspisah ke kolom A (Tanggal) dan kolom B (Tim)</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        // Inisialisasi aplikasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            // Set tanggal default ke hari ini
            const today = new Date();
            const todayString = today.toISOString().split('T')[0];
            document.getElementById('startDate').value = todayString;
        });

        // Event listener untuk form submission
        document.getElementById('scheduleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            generateSchedule();
        });

        // Fungsi utama untuk generate jadwal
        function generateSchedule() {
            // Ambil data dari form
            const startDateInput = document.getElementById('startDate').value;
            const teamCount = parseInt(document.getElementById('teamCount').value);
            const interval = parseInt(document.getElementById('interval').value);
            const teamNamesInput = document.getElementById('teamNames').value.trim();

            // Validasi input
            if (!startDateInput || teamCount < 1 || interval < 1) {
                alert('Mohon isi semua field dengan benar!');
                return;
            }

            // Parse tanggal mulai
            const startDate = new Date(startDateInput);

            // Generate nama tim
            const teamNames = generateTeamNames(teamNamesInput, teamCount);

            // Generate jadwal untuk beberapa periode ke depan (misal 3 bulan)
            const scheduleData = generateScheduleData(startDate, teamNames, interval);

            // Render hasil
            renderResults(scheduleData, teamNames);

            // Generate export data
            generateExportData(scheduleData);

            // Tampilkan section hasil
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('exportSection').classList.remove('hidden');

            // Scroll ke hasil
            document.getElementById('resultsSection').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // Fungsi untuk generate nama tim
        function generateTeamNames(input, count) {
            if (input) {
                // Jika ada input, gunakan nama yang diinput
                const names = input.split('\n')
                    .map(name => name.trim())
                    .filter(name => name.length > 0);
                
                // Jika kurang dari jumlah tim, tambahkan Tim X
                while (names.length < count) {
                    names.push(`Tim ${names.length + 1}`);
                }
                
                return names.slice(0, count);
            } else {
                // Jika kosong, generate otomatis
                const names = [];
                for (let i = 1; i <= count; i++) {
                    names.push(`Tim ${i}`);
                }
                return names;
            }
        }

        // Fungsi untuk generate data jadwal
        function generateScheduleData(startDate, teamNames, interval) {
            const scheduleData = [];
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Reset waktu untuk perbandingan tanggal saja

            // Generate jadwal untuk 90 hari ke depan (3 bulan)
            const totalDays = 90;
            let currentDate = new Date(startDate);
            let teamIndex = 0;

            for (let day = 0; day < totalDays; day += interval) {
                const scheduleDate = new Date(currentDate);
                const team = teamNames[teamIndex % teamNames.length];
                
                // Format tanggal dan hari dalam bahasa Indonesia
                const dateString = formatDateIndonesian(scheduleDate);
                const isToday = scheduleDate.getTime() === today.getTime();

                scheduleData.push({
                    date: scheduleDate,
                    dateString: dateString,
                    team: team,
                    isToday: isToday
                });

                // Pindah ke tanggal berikutnya
                currentDate.setDate(currentDate.getDate() + interval);
                teamIndex++;
            }

            return scheduleData;
        }

        // Fungsi untuk format tanggal dalam bahasa Indonesia
        function formatDateIndonesian(date) {
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                           'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

            const dayName = days[date.getDay()];
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();

            return `${dayName}, ${day} ${month} ${year}`;
        }

        // Fungsi untuk format tanggal DD/MM/YYYY
        function formatDateDDMMYYYY(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Fungsi untuk render hasil jadwal
        function renderResults(scheduleData, teamNames) {
            // Render summary
            renderSummary(scheduleData);

            // Render tabel dengan pembagian kolom
            renderScheduleTables(scheduleData);
        }

        // Fungsi untuk render summary
        function renderSummary(scheduleData) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            // Cari jadwal selanjutnya (hari ini atau setelah hari ini)
            const nextSchedule = scheduleData.find(item => item.date >= today);

            const summaryContainer = document.getElementById('summaryContainer');
            
            if (nextSchedule) {
                const nextDateFormatted = formatDateDDMMYYYY(nextSchedule.date);
                summaryContainer.innerHTML = `
                    <div class="summary">
                        <h3>Jadwal Selanjutnya</h3>
                        <p><strong>${nextSchedule.team}</strong> pada ${nextDateFormatted}</p>
                    </div>
                `;
            } else {
                summaryContainer.innerHTML = `
                    <div class="summary">
                        <h3>Jadwal Selanjutnya</h3>
                        <p>Tidak ada jadwal yang akan datang dalam periode ini</p>
                    </div>
                `;
            }
        }

        // Fungsi untuk render tabel jadwal dengan responsive columns
        function renderScheduleTables(scheduleData) {
            const tableGrid = document.getElementById('tableGrid');
            tableGrid.innerHTML = '';

            // Bagi data menjadi beberapa bagian untuk ditampilkan dalam kolom
            // Setiap tabel menampilkan sekitar 30 hari
            const itemsPerTable = 30;
            const totalTables = Math.ceil(scheduleData.length / itemsPerTable);

            for (let tableIndex = 0; tableIndex < totalTables; tableIndex++) {
                const startIndex = tableIndex * itemsPerTable;
                const endIndex = Math.min(startIndex + itemsPerTable, scheduleData.length);
                const tableData = scheduleData.slice(startIndex, endIndex);

                // Tentukan judul tabel berdasarkan rentang tanggal
                const firstDate = tableData[0].date;
                const lastDate = tableData[tableData.length - 1].date;
                const tableTitle = `${formatDateDDMMYYYY(firstDate)} - ${formatDateDDMMYYYY(lastDate)}`;

                // Buat container tabel
                const tableSection = document.createElement('div');
                tableSection.className = 'table-section';

                // Buat header tabel
                const tableHeader = document.createElement('div');
                tableHeader.className = 'table-header';
                tableHeader.textContent = tableTitle;

                // Buat tabel
                const table = document.createElement('table');
                table.className = 'schedule-table';

                // Buat header tabel
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Tanggal, Hari</th>
                            <th>Tim Bertugas</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableData.map(item => `
                            <tr ${item.isToday ? 'class="today-row"' : ''}>
                                <td>${item.dateString}</td>
                                <td><strong>${item.team}</strong></td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;

                // Susun elemen
                tableSection.appendChild(tableHeader);
                tableSection.appendChild(table);
                tableGrid.appendChild(tableSection);
            }
        }

        // Fungsi untuk generate data export
        function generateExportData(scheduleData) {
            const exportTextarea = document.getElementById('exportData');
            
            // Format data sebagai CSV (DD/MM/YYYY,Tim X)
            const csvData = scheduleData.map(item => {
                const dateFormatted = formatDateDDMMYYYY(item.date);
                return `${dateFormatted},${item.team}`;
            }).join('\n');

            exportTextarea.value = csvData;
        }

        // Fungsi untuk copy export data
        function copyExportData() {
            const exportTextarea = document.getElementById('exportData');
            exportTextarea.select();
            exportTextarea.setSelectionRange(0, 99999); // Untuk mobile

            try {
                document.execCommand('copy');
                alert('Data berhasil disalin ke clipboard!');
            } catch (err) {
                alert('Gagal menyalin data. Silakan copy manual dengan Ctrl+A lalu Ctrl+C');
            }
        }

        // Fungsi utilitas untuk debugging (bisa dihapus di production)
        function debugLog(message, data = null) {
            if (console && console.log) {
                if (data) {
                    console.log(message, data);
                } else {
                    console.log(message);
                }
            }
        }
    </script>
</body>
</html>
